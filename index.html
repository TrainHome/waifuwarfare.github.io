<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waifu Warfare: Tower Tactics - –ü—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .status-message {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 0.9rem;
            display: none;
        }
        .error-status {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border-left: 3px solid #f44336;
        }
        .success-status {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            border-left: 3px solid #4CAF50;
        }
        .checking-status {
            background: rgba(255, 215, 0, 0.1);
            color: #FFD700;
            border-left: 3px solid #FFD700;
        }
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        #debug-info {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-top: 20px;
            font-size: 0.8rem;
            display: none;
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header id="header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <div class="logo-text">Waifu<span>Warfare</span></div>
                </a>
                <nav>
                    <ul>
                        <li><a href="#about">–û–± –∏–≥—Ä–µ</a></li>
                        <li><a href="#features">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</a></li>
                        <li><a href="#characters">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</a></li>
                        <li><a href="#preregistration">–ü—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                        <li><a href="download.html" class="nav-btn">–°–∫–∞—á–∞—Ç—å</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- –ì–µ—Ä–æ–π-—Å–µ–∫—Ü–∏—è -->
    <section class="hero" id="about">
        <div class="container">
            <div class="hero-content floating">
                <h1 class="hero-title">Waifu Warfare: Tower Tactics</h1>
                <p class="hero-subtitle">–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –±–∏—Ç–≤—ã –≤ –∞–Ω–∏–º–æ-—Å—Ç–∏–ª–µ</p>
                <p class="hero-description">–°–æ–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –∫–æ–ª–ª–µ–∫—Ü–∏—é —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –≤–∞–π—Ñ—É –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –Ω–µ–ø–æ–±–µ–¥–∏–º—É—é —Ç–∞–∫—Ç–∏–∫—É! –í–∞—Å –∂–¥—É—Ç —ç–ø–∏—á–µ—Å–∫–∏–µ —Å—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –±–∞—à–Ω—è—Ö, —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –≥–µ–π–º–ø–ª–µ–π –≤ —Å—Ç–∏–ª–µ –∞–Ω–∏–º–µ.</p>
                
                <div class="hero-btns">
                    <a href="#preregistration" class="btn-primary">–ü—Ä–µ–¥–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </div>
                
                <div class="countdown">
                    <div class="countdown-item">
                        <div class="countdown-number" id="days">00</div>
                        <div class="countdown-label">–î–Ω–µ–π</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="hours">00</div>
                        <div class="countdown-label">–ß–∞—Å–æ–≤</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="minutes">00</div>
                        <div class="countdown-label">–ú–∏–Ω—É—Ç</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="seconds">00</div>
                        <div class="countdown-label">–°–µ–∫—É–Ω–¥</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- –§–æ—Ä–º–∞ –ø—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <section class="preregistration" id="preregistration">
        <div class="container">
            <h2 class="section-title">–ü—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <div class="form-container">
                <form id="prereg-form">
                    <!-- –ü–æ–ª–µ –¥–ª—è email -->
                    <div class="form-group">
                        <label for="email">Email –∞–¥—Ä–µ—Å</label>
                        <input type="email" id="email" name="email" placeholder="your@email.com" required>
                        <div class="status-message" id="email-status"></div>
                    </div>
                    
                    <!-- –ü–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ –∏–≥—Ä–æ–∫–∞ -->
                    <div class="form-group">
                        <label for="username">–ñ–µ–ª–∞–µ–º–æ–µ –∏–º—è –∏–≥—Ä–æ–∫–∞</label>
                        <input type="text" id="username" name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–æ–º–∞–Ω–¥–∏—Ä–∞" required>
                        <div class="status-message" id="username-status"></div>
                    </div>
                    
                    <!-- –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã -->
                    <div class="form-group">
                        <label>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                        <div class="platforms">
                            <div class="platform" onclick="selectPlatform(this)">
                                <input type="radio" name="platform" value="PC" required>
                                <i class="fas fa-desktop"></i>
                                <span>PC</span>
                            </div>
                            <div class="platform" onclick="selectPlatform(this)">
                                <input type="radio" name="platform" value="Mobile">
                                <i class="fas fa-mobile-alt"></i>
                                <span>Mobile</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ -->
                    <div class="form-group">
                        <label for="region">–†–µ–≥–∏–æ–Ω</label>
                        <select id="region" name="region" required>
                            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</option>
                            <option value="–ï–≤—Ä–æ–ø–∞">–ï–≤—Ä–æ–ø–∞</option>
                            <option value="–°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞">–°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞</option>
                            <option value="–ê–∑–∏—è">–ê–∑–∏—è</option>
                            <option value="–î—Ä—É–≥–æ–π">–î—Ä—É–≥–æ–π</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submit-btn">
                        <span id="submit-text">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ</span>
                        <span id="loading-spinner" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º...
                        </span>
                    </button>
                    
                    <div id="form-message" style="margin-top: 15px; display: none;"></div>
                    
                    <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div id="debug-info">
                        <strong>–û—Ç–ª–∞–¥–∫–∞:</strong>
                        <div id="debug-log"></div>
                    </div>
                </form>
                
                <!-- –°—Å—ã–ª–∫–∞ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) -->
                <div style="text-align: center; margin-top: 20px; font-size: 0.8rem;">
                    <a href="#" onclick="testAPI(); return false;">–¢–µ—Å—Ç API</a> | 
                    <a href="https://docs.google.com/spreadsheets/d/1o9T6bctuz0LmBtLjgRE4iF-2U1P6EGQm3LX9gnN-1S0/edit#gid=0" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>
                </div>
            </div>
        </div>
    </section>

    <!-- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã -->
    <section class="features" id="features">
        <div class="container">
            <h2 class="section-title">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üëë</div>
                    <h3>–ö–æ–ª–ª–µ–∫—Ü–∏—è –≤–∞–π—Ñ—É</h3>
                    <p>–°–æ–±–∏—Ä–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏ –∏ —Å—Ç–∏–ª—è–º–∏ –∞–Ω–∏–º–µ-–∞—Ä—Ç–∞.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üè∞</div>
                    <h3>–¢–∞–∫—Ç–∏–∫–∞ –±–∞—à–µ–Ω</h3>
                    <p>–†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞—â–∏—Ç—ã –∏ –∞—Ç–∞–∫–∏ –Ω–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –±–∞—à–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–∞—Ö.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">‚öîÔ∏è</div>
                    <h3>–î–∏–Ω–∞–º–∏—á–Ω—ã–µ –±–æ–∏</h3>
                    <p>–†–µ–∞–ª—å–Ω—ã–µ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ä–∞–∂–µ–Ω–∏—è —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ RPG –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üé®</div>
                    <h3>–ê–Ω–∏–º–µ-—Å—Ç–∏–ª—å</h3>
                    <p>–ü–æ—Ç—Ä—è—Å–∞—é—â–∞—è –≥—Ä–∞—Ñ–∏–∫–∞ –≤ —Å—Ç–∏–ª–µ –∞–Ω–∏–º–µ —Å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ –∏ –ª–æ–∫–∞—Ü–∏—è–º–∏.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üë•</div>
                    <h3>PvP –∏ PvE —Ä–µ–∂–∏–º—ã</h3>
                    <p>–°—Ä–∞–∂–∞–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –∏–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–µ PvE –∫–∞–º–ø–∞–Ω–∏–∏.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3>–ü—Ä–æ–∫–∞—á–∫–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ</h3>
                    <p>–£–ª—É—á—à–∞–π—Ç–µ —Å–≤–æ–∏—Ö –≤–∞–π—Ñ—É, –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ –∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–¥–µ–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo-text">Waifu<span>Warfare</span></div>
                </div>
                
                <div class="footer-links">
                    <a href="#" onclick="downloadPrivacyPolicy()">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                    <a href="#" onclick="downloadTerms()">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                    <a href="https://docs.google.com/spreadsheets/d/1o9T6bctuz0LmBtLjgRE4iF-2U1P6EGQm3LX9gnN-1S0/edit?usp=sharing" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</a>
                    <a href="#">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
                    <a href="#">–û –Ω–∞—Å</a>
                </div>
                
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-discord"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-reddit"></i></a>
                </div>
                
                <p class="copyright">¬© 2023 Waifu Warfare: Tower Tactics. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script>
        // URL –≤–∞—à–µ–≥–æ Google Apps Script (–û–ë–ù–û–í–õ–ï–ù–û!)
        const API_URL = 'https://script.google.com/macros/s/AKfycbzy5-VkDA0klcXXPJZy2gmTpe4_o2wn7o7vmzCg7RYHmOUT7uvMTRf0ntviAH0IGrcA/exec';
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏
        function logDebug(message) {
            console.log('[DEBUG]', message);
            const debugLog = document.getElementById('debug-log');
            if (debugLog) {
                debugLog.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
                document.getElementById('debug-info').style.display = 'block';
            }
        }
        
        // –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
        function updateCountdown() {
            const launchDate = new Date('2026-06-01T00:00:00').getTime();
            const now = new Date().getTime();
            const timeLeft = launchDate - now;
            
            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }
        
        setInterval(updateCountdown, 1000);
        updateCountdown();
        
        // –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        function selectPlatform(element) {
            const platforms = document.querySelectorAll('.platform');
            platforms.forEach(platform => platform.classList.remove('selected'));
            element.classList.add('selected');
            element.querySelector('input').checked = true;
            checkFormValidity();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'status-message ' + type + '-status';
            element.style.display = 'block';
        }
        
        // –°–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function hideStatus(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'none';
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ email
        let emailTimeout;
        document.getElementById('email').addEventListener('input', function() {
            const email = this.value.trim();
            clearTimeout(emailTimeout);
            
            // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email) && email.length > 0) {
                showStatus('email-status', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email', 'error');
                return;
            }
            
            if (email.length === 0) {
                hideStatus('email-status');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
            showStatus('email-status', '–ü—Ä–æ–≤–µ—Ä—è–µ–º email...', 'checking');
            
            emailTimeout = setTimeout(async () => {
                try {
                    logDebug(`–ü—Ä–æ–≤–µ—Ä–∫–∞ email: ${email}`);
                    const response = await fetch(`${API_URL}?action=check&email=${encodeURIComponent(email)}`);
                    const data = await response.json();
                    
                    logDebug(`–û—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ email: ${JSON.stringify(data)}`);
                    
                    if (data.email_exists) {
                        showStatus('email-status', '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω', 'error');
                    } else {
                        showStatus('email-status', '‚úì Email —Å–≤–æ–±–æ–¥–µ–Ω', 'success');
                    }
                } catch (error) {
                    logDebug(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ email: ${error}`);
                    showStatus('email-status', '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏', 'error');
                }
            }, 800);
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∫–∞
        let usernameTimeout;
        document.getElementById('username').addEventListener('input', function() {
            const username = this.value.trim();
            clearTimeout(usernameTimeout);
            
            // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            if (username.length < 3 && username.length > 0) {
                showStatus('username-status', '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            if (username.length > 20) {
                showStatus('username-status', '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –±–æ–ª–µ–µ 20 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            if (username.length === 0) {
                hideStatus('username-status');
                return;
            }
            
            const usernameRegex = /^[a-zA-Z0-9_\-]+$/;
            if (!usernameRegex.test(username)) {
                showStatus('username-status', '–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è', 'error');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
            showStatus('username-status', '–ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º—è...', 'checking');
            
            usernameTimeout = setTimeout(async () => {
                try {
                    logDebug(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏: ${username}`);
                    const response = await fetch(`${API_URL}?action=check&username=${encodeURIComponent(username)}`);
                    const data = await response.json();
                    
                    logDebug(`–û—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–º–µ–Ω–∏: ${JSON.stringify(data)}`);
                    
                    if (data.username_exists) {
                        showStatus('username-status', '–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ', 'error');
                    } else {
                        showStatus('username-status', '‚úì –ò–º—è —Å–≤–æ–±–æ–¥–Ω–æ', 'success');
                    }
                } catch (error) {
                    logDebug(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–º–µ–Ω–∏: ${error}`);
                    showStatus('username-status', '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏', 'error');
                }
            }, 800);
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
        function checkFormValidity() {
            const email = document.getElementById('email').value.trim();
            const username = document.getElementById('username').value.trim();
            const platform = document.querySelector('input[name="platform"]:checked');
            const region = document.getElementById('region').value;
            const submitBtn = document.getElementById('submit-btn');
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const usernameRegex = /^[a-zA-Z0-9_\-]+$/;
            
            const isValid = emailRegex.test(email) && 
                           username.length >= 3 && 
                           username.length <= 20 && 
                           usernameRegex.test(username) && 
                           platform && 
                           region;
            
            submitBtn.disabled = !isValid;
            return isValid;
        }
        
        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        document.getElementById('email').addEventListener('input', checkFormValidity);
        document.getElementById('username').addEventListener('input', checkFormValidity);
        document.getElementById('region').addEventListener('change', checkFormValidity);
        document.querySelectorAll('input[name="platform"]').forEach(input => {
            input.addEventListener('change', checkFormValidity);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('prereg-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!checkFormValidity()) {
                showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            const messageDiv = document.getElementById('form-message');
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const email = document.getElementById('email').value.trim();
            const username = document.getElementById('username').value.trim();
            const platform = document.querySelector('input[name="platform"]:checked').value;
            const region = document.getElementById('region').value;
            
            logDebug(`–ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é: ${email}, ${username}, ${platform}, ${region}`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            submitText.style.display = 'none';
            loadingSpinner.style.display = 'inline';
            submitBtn.disabled = true;
            messageDiv.style.display = 'none';
            
            try {
                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const params = new URLSearchParams();
                params.append('action', 'register');
                params.append('email', email);
                params.append('username', username);
                params.append('platform', platform);
                params.append('region', region);
                
                logDebug(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞: ${API_URL}?${params.toString()}`);
                
                const response = await fetch(`${API_URL}?${params.toString()}`);
                const result = await response.json();
                
                logDebug(`–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${JSON.stringify(result)}`);
                
                if (result.success) {
                    showMessage(`–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –∫–æ–º–∞–Ω–¥–∏—Ä ${username}!`, 'success');
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    this.reset();
                    document.querySelectorAll('.platform').forEach(p => p.classList.remove('selected'));
                    hideStatus('email-status');
                    hideStatus('username-status');
                    
                } else if (result.email_exists) {
                    showMessage('–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω', 'error');
                    showStatus('email-status', '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω', 'error');
                } else if (result.username_exists) {
                    showMessage('–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ', 'error');
                    showStatus('username-status', '–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ', 'error');
                } else {
                    const errorMsg = result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    showMessage('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + errorMsg, 'error');
                    logDebug(`–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${errorMsg}`);
                }
                
            } catch (error) {
                logDebug(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error}`);
                console.error('Registration error:', error);
                showMessage('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.', 'error');
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                submitText.style.display = 'inline';
                loadingSpinner.style.display = 'none';
                submitBtn.disabled = false;
                checkFormValidity();
            }
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(text, type) {
            const messageDiv = document.getElementById('form-message');
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            messageDiv.style.padding = '12px';
            messageDiv.style.borderRadius = '8px';
            messageDiv.style.textAlign = 'center';
            messageDiv.style.fontWeight = '500';
            
            if (type === 'success') {
                messageDiv.style.color = '#4CAF50';
                messageDiv.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
                messageDiv.style.border = '1px solid #4CAF50';
            } else {
                messageDiv.style.color = '#f44336';
                messageDiv.style.backgroundColor = 'rgba(244, 67, 54, 0.1)';
                messageDiv.style.border = '1px solid #f44336';
            }
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // –¢–µ—Å—Ç API —Ñ—É–Ω–∫—Ü–∏–∏
        async function testAPI() {
            logDebug('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...');
            
            try {
                // –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
                const testEmail = 'test@example.com';
                const testUsername = 'TestPlayer';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ email
                logDebug(`–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ email: ${testEmail}`);
                const checkEmailResponse = await fetch(`${API_URL}?action=check&email=${encodeURIComponent(testEmail)}`);
                const checkEmailData = await checkEmailResponse.json();
                logDebug(`–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ email: ${JSON.stringify(checkEmailData)}`);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏
                logDebug(`–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–º–µ–Ω–∏: ${testUsername}`);
                const checkUsernameResponse = await fetch(`${API_URL}?action=check&username=${encodeURIComponent(testUsername)}`);
                const checkUsernameData = await checkUsernameResponse.json();
                logDebug(`–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–º–µ–Ω–∏: ${JSON.stringify(checkUsernameData)}`);
                
                // –¢–µ—Å—Ç –ø—É—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                logDebug('–¢–µ—Å—Ç –ø—É—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞...');
                const emptyResponse = await fetch(`${API_URL}?action=test`);
                const emptyData = await emptyResponse.json();
                logDebug(`–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: ${JSON.stringify(emptyData)}`);
                
                showMessage('–¢–µ—Å—Ç API –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.', 'success');
                
            } catch (error) {
                logDebug(`–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ API: ${error}`);
                showMessage('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.', 'error');
            }
        }
        
        // –°–∫–∞—á–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
        function downloadPrivacyPolicy() {
            const content = `–ü–û–õ–ò–¢–ò–ö–ê –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò

Waifu Warfare: Tower Tactics

1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
–î–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Google Apps Script API –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Google –¢–∞–±–ª–∏—Ü–µ.

2. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
–ö–∞–∂–¥—ã–π email –∏ –∏–º—è –∏–≥—Ä–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å.

3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
–î–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã.

–î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}`;
            
            downloadFile(content, 'privacy_policy.txt');
        }
        
        // –°–∫–∞—á–∞—Ç—å —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        function downloadTerms() {
            const content = `–£–°–õ–û–í–ò–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

Waifu Warfare: Tower Tactics

1. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ö–∞–∂–¥–æ–µ –∏–º—è –∏–≥—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
- –ö–∞–∂–¥—ã–π email –∞–¥—Ä–µ—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

2. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.

3. –í–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
–ò–≥—Ä–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ç–∞—Ä—à–µ 12 –ª–µ—Ç.

–î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}`;
            
            downloadFile(content, 'terms_of_use.txt');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —à–∞–ø–∫–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
        window.addEventListener('scroll', function() {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Registration system loaded');
            checkFormValidity();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å URL –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            logDebug(`API URL: ${API_URL}`);
            logDebug(`–¢–∞–±–ª–∏—Ü–∞: https://docs.google.com/spreadsheets/d/1o9T6bctuz0LmBtLjgRE4iF-2U1P6EGQm3LX9gnN-1S0/edit`);
        });
    </script>
</body>
</html>
