<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waifu Warfare: Tower Tactics - –ü—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .error-message {
            color: #f44336;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
            padding: 5px;
            border-radius: 4px;
            background: rgba(244, 67, 54, 0.1);
            border-left: 3px solid #f44336;
        }
        .success-message {
            color: #4CAF50;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
            padding: 5px;
            border-radius: 4px;
            background: rgba(76, 175, 80, 0.1);
            border-left: 3px solid #4CAF50;
        }
        .checking {
            color: #FFD700;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
            padding: 5px;
            border-radius: 4px;
            background: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #FFD700;
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header id="header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <div class="logo-text">Waifu<span>Warfare</span></div>
                </a>
                <nav>
                    <ul>
                        <li><a href="#about">–û–± –∏–≥—Ä–µ</a></li>
                        <li><a href="#features">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</a></li>
                        <li><a href="#characters">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</a></li>
                        <li><a href="#preregistration">–ü—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                        <li><a href="download.html" class="nav-btn">–°–∫–∞—á–∞—Ç—å</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- –ì–µ—Ä–æ–π-—Å–µ–∫—Ü–∏—è -->
    <section class="hero" id="about">
        <div class="container">
            <div class="hero-content floating">
                <h1 class="hero-title">Waifu Warfare: Tower Tactics</h1>
                <p class="hero-subtitle">–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –±–∏—Ç–≤—ã –≤ –∞–Ω–∏–º–æ-—Å—Ç–∏–ª–µ</p>
                <p class="hero-description">–°–æ–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –∫–æ–ª–ª–µ–∫—Ü–∏—é —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –≤–∞–π—Ñ—É –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –Ω–µ–ø–æ–±–µ–¥–∏–º—É—é —Ç–∞–∫—Ç–∏–∫—É! –í–∞—Å –∂–¥—É—Ç —ç–ø–∏—á–µ—Å–∫–∏–µ —Å—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –±–∞—à–Ω—è—Ö, —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –≥–µ–π–º–ø–ª–µ–π –≤ —Å—Ç–∏–ª–µ –∞–Ω–∏–º–µ.</p>
                
                <div class="hero-btns">
                    <a href="#preregistration" class="btn-primary">–ü—Ä–µ–¥–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </div>
                
                <div class="countdown">
                    <div class="countdown-item">
                        <div class="countdown-number" id="days">00</div>
                        <div class="countdown-label">–î–Ω–µ–π</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="hours">00</div>
                        <div class="countdown-label">–ß–∞—Å–æ–≤</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="minutes">00</div>
                        <div class="countdown-label">–ú–∏–Ω—É—Ç</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="seconds">00</div>
                        <div class="countdown-label">–°–µ–∫—É–Ω–¥</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- –§–æ—Ä–º–∞ –ø—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <section class="preregistration" id="preregistration">
        <div class="container">
            <h2 class="section-title">–ü—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <div class="form-container">
                <form id="prereg-form">
                    <!-- –ü–æ–ª–µ –¥–ª—è email -->
                    <div class="form-group">
                        <label for="email">Email –∞–¥—Ä–µ—Å</label>
                        <input type="email" id="email" name="email" placeholder="your@email.com" required>
                        <div class="error-message" id="email-error"></div>
                        <div class="success-message" id="email-success">‚úì Email —Å–≤–æ–±–æ–¥–µ–Ω</div>
                        <div class="checking" id="email-checking">–ü—Ä–æ–≤–µ—Ä—è–µ–º email...</div>
                    </div>
                    
                    <!-- –ü–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ –∏–≥—Ä–æ–∫–∞ -->
                    <div class="form-group">
                        <label for="username">–ñ–µ–ª–∞–µ–º–æ–µ –∏–º—è –∏–≥—Ä–æ–∫–∞</label>
                        <input type="text" id="username" name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–æ–º–∞–Ω–¥–∏—Ä–∞" required>
                        <div class="error-message" id="username-error"></div>
                        <div class="success-message" id="username-success">‚úì –ò–º—è —Å–≤–æ–±–æ–¥–Ω–æ</div>
                        <div class="checking" id="username-checking">–ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º—è...</div>
                    </div>
                    
                    <!-- –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã -->
                    <div class="form-group">
                        <label>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                        <div class="platforms">
                            <div class="platform" onclick="selectPlatform(this, 'PC')">
                                <input type="radio" name="platform" value="PC" required>
                                <i class="fas fa-desktop"></i>
                                <span>PC</span>
                            </div>
                            <div class="platform" onclick="selectPlatform(this, 'Mobile')">
                                <input type="radio" name="platform" value="Mobile">
                                <i class="fas fa-mobile-alt"></i>
                                <span>Mobile</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ -->
                    <div class="form-group">
                        <label for="region">–†–µ–≥–∏–æ–Ω</label>
                        <select id="region" name="region" required>
                            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</option>
                            <option value="–ï–≤—Ä–æ–ø–∞">–ï–≤—Ä–æ–ø–∞</option>
                            <option value="–°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞">–°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞</option>
                            <option value="–ê–∑–∏—è">–ê–∑–∏—è</option>
                            <option value="–î—Ä—É–≥–æ–π">–î—Ä—É–≥–æ–π</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submit-btn" disabled>
                        <span id="submit-text">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ</span>
                        <span id="loading-spinner" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º...
                        </span>
                    </button>
                    <div id="form-message" style="margin-top: 15px; display: none;"></div>
                </form>
            </div>
        </div>
    </section>

    <!-- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã -->
    <section class="features" id="features">
        <div class="container">
            <h2 class="section-title">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üëë</div>
                    <h3>–ö–æ–ª–ª–µ–∫—Ü–∏—è –≤–∞–π—Ñ—É</h3>
                    <p>–°–æ–±–∏—Ä–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏ –∏ —Å—Ç–∏–ª—è–º–∏ –∞–Ω–∏–º–µ-–∞—Ä—Ç–∞.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üè∞</div>
                    <h3>–¢–∞–∫—Ç–∏–∫–∞ –±–∞—à–µ–Ω</h3>
                    <p>–†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞—â–∏—Ç—ã –∏ –∞—Ç–∞–∫–∏ –Ω–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –±–∞—à–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–∞—Ö.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">‚öîÔ∏è</div>
                    <h3>–î–∏–Ω–∞–º–∏—á–Ω—ã–µ –±–æ–∏</h3>
                    <p>–†–µ–∞–ª—å–Ω—ã–µ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ä–∞–∂–µ–Ω–∏—è —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ RPG –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üé®</div>
                    <h3>–ê–Ω–∏–º–µ-—Å—Ç–∏–ª—å</h3>
                    <p>–ü–æ—Ç—Ä—è—Å–∞—é—â–∞—è –≥—Ä–∞—Ñ–∏–∫–∞ –≤ —Å—Ç–∏–ª–µ –∞–Ω–∏–º–µ —Å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ –∏ –ª–æ–∫–∞—Ü–∏—è–º–∏.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üë•</div>
                    <h3>PvP –∏ PvE —Ä–µ–∂–∏–º—ã</h3>
                    <p>–°—Ä–∞–∂–∞–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –∏–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–µ PvE –∫–∞–º–ø–∞–Ω–∏–∏.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3>–ü—Ä–æ–∫–∞—á–∫–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ</h3>
                    <p>–£–ª—É—á—à–∞–π—Ç–µ —Å–≤–æ–∏—Ö –≤–∞–π—Ñ—É, –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ –∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–¥–µ–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo-text">Waifu<span>Warfare</span></div>
                </div>
                
                <div class="footer-links">
                    <a href="#" onclick="downloadPrivacyPolicy()">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                    <a href="#" onclick="downloadTerms()">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                    <a href="https://docs.google.com/spreadsheets/d/1o9T6bctuz0LmBtLjgRE4iF-2U1P6EGQm3LX9gnN-1S0/edit?usp=sharing" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</a>
                    <a href="#">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
                    <a href="#">–û –Ω–∞—Å</a>
                </div>
                
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-discord"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-reddit"></i></a>
                </div>
                
                <p class="copyright">¬© 2023 Waifu Warfare: Tower Tactics. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script>
        // URL –≤–∞—à–µ–≥–æ Google Apps Script (–ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®!)
        const API_URL = 'https://script.google.com/macros/s/AKfycbwKg9AcgIsVg7MMnDkOjQ7vBMPAPDDqbVxQtvIF0diiceQTFpHD2ppzeB2KwGjVJ-SN/exec';
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        let emailValid = false;
        let usernameValid = false;
        let isChecking = false;
        
        // –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
        function updateCountdown() {
            const launchDate = new Date('2026-06-01T00:00:00').getTime();
            const now = new Date().getTime();
            const timeLeft = launchDate - now;
            
            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }
        
        setInterval(updateCountdown, 1000);
        updateCountdown();
        
        // –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        function selectPlatform(element, value) {
            const platforms = document.querySelectorAll('.platform');
            platforms.forEach(platform => platform.classList.remove('selected'));
            element.classList.add('selected');
            element.querySelector('input').checked = true;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        async function checkForDuplicates(email, username) {
            if (isChecking) return;
            
            isChecking = true;
            const params = new URLSearchParams();
            params.append('action', 'check_duplicate');
            
            if (email) params.append('email', email);
            if (username) params.append('username', username);
            
            try {
                const response = await fetch(`${API_URL}?${params.toString()}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:', error);
                return { email_exists: false, username_exists: false, can_register: true };
            } finally {
                isChecking = false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        async function registerUser(data) {
            const params = new URLSearchParams();
            params.append('action', 'register');
            params.append('email', data.email);
            params.append('username', data.username);
            params.append('platform', data.platform);
            params.append('region', data.region);
            
            try {
                const response = await fetch(`${API_URL}?${params.toString()}`);
                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                throw error;
            }
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        function validateForm(email, username) {
            let isValid = true;
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showFieldError('email', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å');
                isValid = false;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∏–∫–∞
            if (username.length < 3) {
                showFieldError('username', '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤');
                isValid = false;
            }
            
            if (username.length > 20) {
                showFieldError('username', '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –±–æ–ª–µ–µ 20 —Å–∏–º–≤–æ–ª–æ–≤');
                isValid = false;
            }
            
            const usernameRegex = /^[a-zA-Z0-9_\-]+$/;
            if (!usernameRegex.test(username)) {
                showFieldError('username', '–ò–º—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è');
                isValid = false;
            }
            
            return isValid;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—è
        function showFieldError(field, message) {
            const errorDiv = document.getElementById(`${field}-error`);
            const successDiv = document.getElementById(`${field}-success`);
            const checkingDiv = document.getElementById(`${field}-checking`);
            
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            successDiv.style.display = 'none';
            checkingDiv.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            if (field === 'email') emailValid = false;
            if (field === 'username') usernameValid = false;
            updateSubmitButton();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö –ø–æ–ª—è
        function showFieldSuccess(field) {
            const errorDiv = document.getElementById(`${field}-error`);
            const successDiv = document.getElementById(`${field}-success`);
            const checkingDiv = document.getElementById(`${field}-checking`);
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'block';
            checkingDiv.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            if (field === 'email') emailValid = true;
            if (field === 'username') usernameValid = true;
            updateSubmitButton();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–ª—è
        function showFieldChecking(field) {
            const errorDiv = document.getElementById(`${field}-error`);
            const successDiv = document.getElementById(`${field}-success`);
            const checkingDiv = document.getElementById(`${field}-checking`);
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            checkingDiv.style.display = 'block';
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
        function updateSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            const platform = document.querySelector('input[name="platform"]:checked');
            const region = document.getElementById('region').value;
            
            if (emailValid && usernameValid && platform && region) {
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            } else {
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.7';
                submitBtn.style.cursor = 'not-allowed';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ email –ø—Ä–∏ –≤–≤–æ–¥–µ
        let emailTimeout;
        document.getElementById('email').addEventListener('input', async function() {
            const email = this.value.trim();
            
            clearTimeout(emailTimeout);
            
            // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                if (email.length > 0) {
                    showFieldError('email', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å');
                } else {
                    const errorDiv = document.getElementById('email-error');
                    const successDiv = document.getElementById('email-success');
                    const checkingDiv = document.getElementById('email-checking');
                    errorDiv.style.display = 'none';
                    successDiv.style.display = 'none';
                    checkingDiv.style.display = 'none';
                    emailValid = false;
                    updateSubmitButton();
                }
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏
            showFieldChecking('email');
            
            emailTimeout = setTimeout(async () => {
                const result = await checkForDuplicates(email, null);
                
                if (result.email_exists) {
                    showFieldError('email', '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                } else {
                    showFieldSuccess('email');
                }
            }, 800);
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
        let usernameTimeout;
        document.getElementById('username').addEventListener('input', async function() {
            const username = this.value.trim();
            
            clearTimeout(usernameTimeout);
            
            // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            if (username.length < 3) {
                if (username.length > 0) {
                    showFieldError('username', '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤');
                } else {
                    const errorDiv = document.getElementById('username-error');
                    const successDiv = document.getElementById('username-success');
                    const checkingDiv = document.getElementById('username-checking');
                    errorDiv.style.display = 'none';
                    successDiv.style.display = 'none';
                    checkingDiv.style.display = 'none';
                    usernameValid = false;
                    updateSubmitButton();
                }
                return;
            }
            
            if (username.length > 20) {
                showFieldError('username', '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –±–æ–ª–µ–µ 20 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            const usernameRegex = /^[a-zA-Z0-9_\-]+$/;
            if (!usernameRegex.test(username)) {
                showFieldError('username', '–ò–º—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏
            showFieldChecking('username');
            
            usernameTimeout = setTimeout(async () => {
                const result = await checkForDuplicates(null, username);
                
                if (result.username_exists) {
                    showFieldError('username', '–≠—Ç–æ –∏–º—è –∏–≥—Ä–æ–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–æ');
                } else {
                    showFieldSuccess('username');
                }
            }, 800);
        });
        
        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ —Ä–µ–≥–∏–æ–Ω–∞
        document.querySelectorAll('input[name="platform"]').forEach(input => {
            input.addEventListener('change', updateSubmitButton);
        });
        
        document.getElementById('region').addEventListener('change', updateSubmitButton);
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('prereg-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            const messageDiv = document.getElementById('form-message');
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const email = document.getElementById('email').value.trim();
            const username = document.getElementById('username').value.trim();
            const platform = document.querySelector('input[name="platform"]:checked');
            const region = document.getElementById('region').value;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–∞ –ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏ —Ä–µ–≥–∏–æ–Ω
            if (!platform) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É', 'error');
                return;
            }
            
            if (!region) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω', 'error');
                return;
            }
            
            // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            if (!validateForm(email, username)) {
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
            if (!emailValid || !usernameValid) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            submitText.style.display = 'none';
            loadingSpinner.style.display = 'inline';
            submitBtn.disabled = true;
            messageDiv.style.display = 'none';
            
            try {
                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API
                const result = await registerUser({
                    email: email,
                    username: username,
                    platform: platform.value,
                    region: region
                });
                
                if (result.success) {
                    // –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                    showMessage(`–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –∫–æ–º–∞–Ω–¥–∏—Ä ${username}! –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.`, 'success');
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    this.reset();
                    document.querySelectorAll('.platform').forEach(p => p.classList.remove('selected'));
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    emailValid = false;
                    usernameValid = false;
                    updateSubmitButton();
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                    document.querySelectorAll('.error-message, .success-message, .checking').forEach(el => {
                        el.style.display = 'none';
                    });
                    
                } else if (result.email_exists || result.username_exists) {
                    // –û–±–Ω–∞—Ä—É–∂–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç (—Ö–æ—Ç—è –º—ã –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –∑–∞—Ä–∞–Ω–µ–µ)
                    let errorMsg = '';
                    if (result.email_exists && result.username_exists) {
                        errorMsg = 'Email –∏ –∏–º—è –∏–≥—Ä–æ–∫–∞ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã';
                    } else if (result.email_exists) {
                        errorMsg = 'Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω';
                        showFieldError('email', '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                    } else {
                        errorMsg = '–ò–º—è –∏–≥—Ä–æ–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–æ';
                        showFieldError('username', '–≠—Ç–æ –∏–º—è –∏–≥—Ä–æ–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–æ');
                    }
                    showMessage(errorMsg, 'error');
                } else {
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                submitText.style.display = 'inline';
                loadingSpinner.style.display = 'none';
                submitBtn.disabled = false;
                updateSubmitButton();
            }
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(text, type) {
            const messageDiv = document.getElementById('form-message');
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            messageDiv.style.padding = '12px';
            messageDiv.style.borderRadius = '8px';
            messageDiv.style.textAlign = 'center';
            messageDiv.style.fontWeight = '500';
            
            if (type === 'success') {
                messageDiv.style.color = '#4CAF50';
                messageDiv.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
                messageDiv.style.border = '1px solid #4CAF50';
            } else {
                messageDiv.style.color = '#f44336';
                messageDiv.style.backgroundColor = 'rgba(244, 67, 54, 0.1)';
                messageDiv.style.border = '1px solid #f44336';
            }
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // –°–∫–∞—á–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
        function downloadPrivacyPolicy() {
            const content = `–ü–û–õ–ò–¢–ò–ö–ê –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò

Waifu Warfare: Tower Tactics

1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
–î–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Google Apps Script API –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Google –¢–∞–±–ª–∏—Ü–µ.
–ú—ã —Å–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
–ö–∞–∂–¥—ã–π email –∏ –∏–º—è –∏–≥—Ä–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π.
–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.

3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
–î–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è:
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ –∏–≥—Ä–µ

–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${new Date().toLocaleDateString('ru-RU')}`;
            
            downloadFile(content, 'privacy_policy.txt');
        }
        
        // –°–∫–∞—á–∞—Ç—å —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        function downloadTerms() {
            const content = `–£–°–õ–û–í–ò–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

Waifu Warfare: Tower Tactics

1. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ö–∞–∂–¥–æ–µ –∏–º—è –∏–≥—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
- –ö–∞–∂–¥—ã–π email –∞–¥—Ä–µ—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –ü–æ–ø—ã—Ç–∫–∏ —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç –∞–∫–∫–∞—É–Ω—Ç–∞ –±—É–¥—É—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã

2. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

3. –í–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
–ò–≥—Ä–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ç–∞—Ä—à–µ 12 –ª–µ—Ç.

–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${new Date().toLocaleDateString('ru-RU')}`;
            
            downloadFile(content, 'terms_of_use.txt');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —à–∞–ø–∫–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
        window.addEventListener('scroll', function() {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
            updateSubmitButton(); // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
        });
    </script>
</body>
</html>
